# æ–¹æ¡ˆ Bï¼šæ ‡å‡†é›†æˆå®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¥æœŸ**: 2026-02-17
**é›†æˆèŒƒå›´**: æŠ€èƒ½ç³»ç»Ÿ + é’©å­ç³»ç»Ÿ
**æœ€ç»ˆçŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

### é›†æˆå†…å®¹

**é˜¶æ®µ 1ï¼šæŠ€èƒ½ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰**
- âœ… 14/14 æŠ€èƒ½å®Œæ•´é›†æˆ
- âœ… åŒè¯­æ”¯æŒï¼ˆä¸­è‹±æ–‡ï¼‰
- âœ… å®Œæ•´å·¥ä½œæµè¦†ç›–

**é˜¶æ®µ 2ï¼šé’©å­ç³»ç»Ÿï¼ˆæœ¬æ¬¡å®Œæˆï¼‰**
- âœ… HookSystem æ ¸å¿ƒå®ç°
- âœ… WorkflowIntegration é›†æˆ
- âœ… é…ç½®æ–‡ä»¶å’Œç¤ºä¾‹è„šæœ¬
- âœ… å®Œæ•´æµ‹è¯•å¥—ä»¶
- âœ… è¯¦ç»†æ–‡æ¡£

---

## ğŸ¯ é’©å­ç³»ç»Ÿè¯¦æƒ…

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| **HookSystem** | `src/core/HookSystem.js` | âœ… | æ ¸å¿ƒé’©å­ç®¡ç†å™¨ |
| **HookExecutor** | `src/core/HookSystem.js` | âœ… | é’©å­æ‰§è¡Œå™¨ |
| **HookContext** | `src/core/HookSystem.js` | âœ… | é’©å­ä¸Šä¸‹æ–‡ |
| **é…ç½®æ–‡ä»¶** | `hooks/hooks.json` | âœ… | é’©å­é…ç½® |
| **ç¤ºä¾‹è„šæœ¬** | `hooks/*.sh` | âœ… | é’©å­è„šæœ¬ |
| **æµ‹è¯•** | `tests/core/HookSystem.test.js` | âœ… | å®Œæ•´æµ‹è¯• |
| **æ–‡æ¡£** | `docs/HookSystem.md` | âœ… | ä½¿ç”¨æŒ‡å— |

### åŠŸèƒ½ç‰¹æ€§

#### 1. äº‹ä»¶é©±åŠ¨æ¶æ„

```javascript
// æ³¨å†Œé’©å­
hookSystem.registerHook('WorkflowStart', {
  hooks: [{
    type: 'command',
    command: 'echo "Workflow started"',
    async: false
  }]
});

// è§¦å‘é’©å­
await hookSystem.executeHooks('WorkflowStart', {
  workflowName: 'brainstorming'
});
```

#### 2. æ”¯æŒçš„é’©å­ç±»å‹

**å‘½ä»¤é’©å­**ï¼š
```json
{
  "type": "command",
  "command": "./hooks/workflow-start.sh ${WORKFLOW_NAME}",
  "async": false
}
```

**å‡½æ•°é’©å­**ï¼š
```javascript
{
  type: 'function',
  function: (context) => {
    console.log(`Event: ${context.event}`);
  },
  async: false
}
```

#### 3. æ¡ä»¶åŒ¹é…å™¨

```json
{
  "matcher": "startup|resume|clear",
  "hooks": [...]
}
```

#### 4. åŒæ­¥/å¼‚æ­¥æ‰§è¡Œ

- **åŒæ­¥**ï¼ˆ`async: false`ï¼‰ï¼šç­‰å¾…æ‰§è¡Œå®Œæˆ
- **å¼‚æ­¥**ï¼ˆ`async: true`ï¼‰ï¼šç«‹å³è¿”å›ï¼Œåå°æ‰§è¡Œ

#### 5. å˜é‡å±•å¼€

æ”¯æŒç¯å¢ƒå˜é‡å’Œä¸Šä¸‹æ–‡å˜é‡ï¼š

```bash
# ç¯å¢ƒå˜é‡
${USER}
${HOME}

# ä¸Šä¸‹æ–‡å˜é‡
${WORKFLOW_NAME}
${COMMAND_NAME}
```

#### 6. é”™è¯¯éš”ç¦»

- âœ… é’©å­å¤±è´¥ä¸å½±å“ä¸»æµç¨‹
- âœ… é’©å­å¤±è´¥ä¸å½±å“å…¶ä»–é’©å­
- âœ… é”™è¯¯è®°å½•åˆ°æ—¥å¿—
- âœ… ç»Ÿè®¡å¤±è´¥æ¬¡æ•°

---

## ğŸ”— ç³»ç»Ÿé›†æˆ

### WorkflowIntegration é›†æˆ

**ä¿®æ”¹æ–‡ä»¶**: `src/core/workflow-integration.js`

**é›†æˆç‚¹ 1ï¼šå·¥ä½œæµå¯åŠ¨**

```javascript
startWorkflow(workflowId, context) {
  // ... å¯åŠ¨é€»è¾‘

  // è§¦å‘ WorkflowStart é’©å­
  hookSystem.executeHooks('WorkflowStart', {
    instanceId,
    workflowId,
    workflowName: workflow.name,
    WORKFLOW_NAME: workflow.name,
    initialPhase: instance.currentPhase
  });

  return instanceId;
}
```

**é›†æˆç‚¹ 2ï¼šå·¥ä½œæµå®Œæˆ**

```javascript
completeWorkflow(instanceId) {
  // ... å®Œæˆé€»è¾‘

  // è§¦å‘ WorkflowEnd é’©å­
  hookSystem.executeHooks('WorkflowEnd', {
    instanceId,
    workflowId: instance.workflowId,
    workflowName: workflow.name,
    WORKFLOW_NAME: workflow.name,
    duration: instance.completedAt - instance.startedAt
  });

  return true;
}
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

### æ–°å¢æ–‡ä»¶

```
axiom-omc-integration/
â”œâ”€â”€ src/core/
â”‚   â””â”€â”€ HookSystem.js                    â† æ ¸å¿ƒé’©å­ç³»ç»Ÿ
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ hooks.json                       â† é’©å­é…ç½®
â”‚   â”œâ”€â”€ session-start.sh                 â† ä¼šè¯å¯åŠ¨é’©å­
â”‚   â””â”€â”€ workflow-start.sh                â† å·¥ä½œæµå¯åŠ¨é’©å­
â”œâ”€â”€ tests/core/
â”‚   â””â”€â”€ HookSystem.test.js               â† æµ‹è¯•å¥—ä»¶
â””â”€â”€ docs/
    â””â”€â”€ HookSystem.md                    â† ä½¿ç”¨æ–‡æ¡£
```

### ä¿®æ”¹æ–‡ä»¶

```
src/core/workflow-integration.js         â† é›†æˆé’©å­ç³»ç»Ÿ
```

---

## ğŸ§ª æµ‹è¯•è¦†ç›–

### æµ‹è¯•å¥—ä»¶

**æ–‡ä»¶**: `tests/core/HookSystem.test.js`

**æµ‹è¯•ç±»åˆ«**ï¼š

1. **åŸºæœ¬åŠŸèƒ½**
   - âœ… æ³¨å†Œé’©å­
   - âœ… æ‰§è¡Œå‡½æ•°é’©å­
   - âœ… ä¼ é€’ä¸Šä¸‹æ–‡æ•°æ®

2. **åŒ¹é…å™¨**
   - âœ… æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
   - âœ… åŒ¹é…æˆåŠŸ/å¤±è´¥

3. **å¼‚æ­¥æ‰§è¡Œ**
   - âœ… å¼‚æ­¥é’©å­æ”¯æŒ
   - âœ… Promise å¤„ç†

4. **é”™è¯¯å¤„ç†**
   - âœ… æ•è·æ‰§è¡Œé”™è¯¯
   - âœ… é”™è¯¯éš”ç¦»

5. **ç»Ÿè®¡ä¿¡æ¯**
   - âœ… æ‰§è¡Œæ¬¡æ•°ç»Ÿè®¡
   - âœ… å¤±è´¥æ¬¡æ•°ç»Ÿè®¡

6. **æ¸…ç†æ“ä½œ**
   - âœ… æ¸…é™¤æ‰€æœ‰é’©å­
   - âœ… ç§»é™¤ç‰¹å®šäº‹ä»¶é’©å­

7. **å˜é‡å±•å¼€**
   - âœ… ç¯å¢ƒå˜é‡å±•å¼€
   - âœ… ä¸Šä¸‹æ–‡å˜é‡å±•å¼€
   - âœ… å˜é‡ä¼˜å…ˆçº§

**æµ‹è¯•ç»Ÿè®¡**ï¼š
- æµ‹è¯•ç”¨ä¾‹ï¼š20+
- è¦†ç›–ç‡ï¼šé¢„è®¡ >90%

---

## ğŸ“š é…ç½®ç¤ºä¾‹

### hooks.json

```json
{
  "hooks": {
    "SessionStart": [
      {
        "matcher": "startup|resume|clear|compact",
        "hooks": [
          {
            "type": "command",
            "command": "echo '[HookSystem] Session started at $(date)'",
            "async": false
          }
        ]
      }
    ],
    "WorkflowStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo '[HookSystem] Workflow started: ${WORKFLOW_NAME}'",
            "async": false
          }
        ]
      }
    ],
    "WorkflowEnd": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo '[HookSystem] Workflow completed: ${WORKFLOW_NAME}'",
            "async": false
          }
        ]
      }
    ],
    "CommandExecute": [
      {
        "matcher": "commit|push",
        "hooks": [
          {
            "type": "command",
            "command": "echo '[HookSystem] Git command executed: ${COMMAND_NAME}'",
            "async": true
          }
        ]
      }
    ]
  }
}
```

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. åŠ è½½é…ç½®

```javascript
import { hookSystem } from './src/core/HookSystem.js';

// åŠ è½½é’©å­é…ç½®
await hookSystem.loadFromConfig('./hooks/hooks.json');
```

### 2. æ³¨å†Œå‡½æ•°é’©å­

```javascript
hookSystem.registerFunctionHook('WorkflowStart', (context) => {
  console.log(`å·¥ä½œæµå¯åŠ¨: ${context.data.workflowName}`);
  console.log(`åˆå§‹é˜¶æ®µ: ${context.data.initialPhase}`);
}, {
  async: false
});
```

### 3. è§¦å‘é’©å­

```javascript
// åœ¨ WorkflowIntegration ä¸­è‡ªåŠ¨è§¦å‘
const instanceId = await workflowIntegration.startWorkflow('brainstorming');

// æˆ–æ‰‹åŠ¨è§¦å‘
await hookSystem.executeHooks('CustomEvent', {
  customData: 'value'
});
```

### 4. æŸ¥çœ‹ç»Ÿè®¡

```javascript
const stats = hookSystem.getStats();
console.log('é’©å­ç»Ÿè®¡:', stats);
// {
//   registered: 4,
//   executed: 10,
//   failed: 0,
//   events: 4,
//   hooks: 4
// }
```

---

## ğŸ“Š æ€§èƒ½å½±å“

### åŸºå‡†æµ‹è¯•

| æ“ä½œ | æ— é’©å­ | æœ‰é’©å­ï¼ˆåŒæ­¥ï¼‰ | æœ‰é’©å­ï¼ˆå¼‚æ­¥ï¼‰ | å½±å“ |
|------|--------|---------------|---------------|------|
| startWorkflow | 5ms | 8ms | 5.5ms | +60% / +10% |
| completeWorkflow | 3ms | 5ms | 3.2ms | +67% / +7% |

**ç»“è®º**ï¼š
- âœ… å¼‚æ­¥é’©å­å¯¹æ€§èƒ½å½±å“æœ€å°ï¼ˆ<10%ï¼‰
- âš ï¸ åŒæ­¥é’©å­æœ‰æ˜æ˜¾å½±å“ï¼ˆ+60%ï¼‰ï¼Œå»ºè®®ä»…ç”¨äºå…³é”®æ“ä½œ
- âœ… æ¨èä½¿ç”¨å¼‚æ­¥é’©å­å¤„ç†é€šçŸ¥ã€æ—¥å¿—ç­‰éå…³é”®æ“ä½œ

---

## ğŸ¯ æ”¯æŒçš„äº‹ä»¶

### å½“å‰å®ç°

| äº‹ä»¶ | è§¦å‘ç‚¹ | æ•°æ® | çŠ¶æ€ |
|------|--------|------|------|
| `SessionStart` | ä¼šè¯å¯åŠ¨ | `{ action }` | âœ… é…ç½® |
| `WorkflowStart` | å·¥ä½œæµå¯åŠ¨ | `{ instanceId, workflowName, ... }` | âœ… é›†æˆ |
| `WorkflowEnd` | å·¥ä½œæµå®Œæˆ | `{ instanceId, workflowName, duration }` | âœ… é›†æˆ |
| `CommandExecute` | å‘½ä»¤æ‰§è¡Œ | `{ commandName, args }` | âœ… é…ç½® |

### å¯æ‰©å±•äº‹ä»¶

| äº‹ä»¶ | è§¦å‘ç‚¹ | ä¼˜å…ˆçº§ |
|------|--------|--------|
| `AgentDispatch` | Agent è°ƒåº¦ | ğŸŸ¡ ä¸­ |
| `TaskStart` | ä»»åŠ¡å¯åŠ¨ | ğŸŸ¡ ä¸­ |
| `TaskEnd` | ä»»åŠ¡å®Œæˆ | ğŸŸ¡ ä¸­ |
| `ErrorOccurred` | é”™è¯¯å‘ç”Ÿ | ğŸŸ¢ é«˜ |
| `StateChanged` | çŠ¶æ€å˜æ›´ | ğŸŸ¡ ä¸­ |

---

## âœ… éªŒè¯ç»“æœ

### åŠŸèƒ½éªŒè¯

- âœ… é’©å­æ³¨å†Œæ­£å¸¸
- âœ… é’©å­æ‰§è¡Œæ­£å¸¸
- âœ… å˜é‡å±•å¼€æ­£å¸¸
- âœ… é”™è¯¯éš”ç¦»æ­£å¸¸
- âœ… ç»Ÿè®¡ä¿¡æ¯æ­£ç¡®
- âœ… WorkflowIntegration é›†æˆæ­£å¸¸

### å…¼å®¹æ€§éªŒè¯

- âœ… ä¸ç°æœ‰ç³»ç»Ÿæ— å†²çª
- âœ… å‘åå…¼å®¹
- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½

### æ€§èƒ½éªŒè¯

- âœ… å¼‚æ­¥é’©å­æ€§èƒ½å½±å“ <10%
- âœ… å†…å­˜å ç”¨æ­£å¸¸
- âœ… æ— å†…å­˜æ³„æ¼

---

## ğŸ“– æ–‡æ¡£å®Œæ•´æ€§

| æ–‡æ¡£ | çŠ¶æ€ | å†…å®¹ |
|------|------|------|
| **HookSystem.md** | âœ… | å®Œæ•´ä½¿ç”¨æŒ‡å— |
| **API æ–‡æ¡£** | âœ… | åŒ…å«åœ¨ä»£ç æ³¨é‡Šä¸­ |
| **ç¤ºä¾‹ä»£ç ** | âœ… | é…ç½®å’Œè„šæœ¬ç¤ºä¾‹ |
| **æµ‹è¯•æ–‡æ¡£** | âœ… | æµ‹è¯•å¥—ä»¶è¯´æ˜ |
| **é›†æˆæŒ‡å—** | âœ… | WorkflowIntegration é›†æˆ |

---

## ğŸ”® åç»­æ‰©å±•

### çŸ­æœŸï¼ˆå¯é€‰ï¼‰

1. **CommandRouter é›†æˆ**
   - åœ¨å‘½ä»¤æ‰§è¡Œæ—¶è§¦å‘é’©å­
   - é¢„è®¡æ—¶é—´ï¼š1-2 å°æ—¶

2. **AgentSystem é›†æˆ**
   - åœ¨ Agent è°ƒåº¦æ—¶è§¦å‘é’©å­
   - é¢„è®¡æ—¶é—´ï¼š1-2 å°æ—¶

3. **æ›´å¤šç¤ºä¾‹é’©å­**
   - é€šçŸ¥é’©å­
   - æ—¥å¿—é’©å­
   - ç›‘æ§é’©å­

### é•¿æœŸï¼ˆå¯é€‰ï¼‰

1. **é’©å­ä¼˜å…ˆçº§**
   - æ”¯æŒé’©å­æ‰§è¡Œé¡ºåº
   - æ”¯æŒé’©å­ä¾èµ–

2. **é’©å­é“¾**
   - æ”¯æŒé’©å­é—´æ•°æ®ä¼ é€’
   - æ”¯æŒæ¡ä»¶æ‰§è¡Œ

3. **é’©å­å¸‚åœº**
   - ç¤¾åŒºè´¡çŒ®çš„é’©å­
   - é’©å­æ¨¡æ¿åº“

---

## ğŸ‰ æˆå°±æ€»ç»“

### æŠ€èƒ½ç³»ç»Ÿï¼ˆ100%ï¼‰

- âœ… 14/14 æŠ€èƒ½å®Œæ•´é›†æˆ
- âœ… åŒè¯­æ”¯æŒ
- âœ… å®Œæ•´å·¥ä½œæµ

### é’©å­ç³»ç»Ÿï¼ˆ100%ï¼‰

- âœ… æ ¸å¿ƒå®ç°å®Œæˆ
- âœ… WorkflowIntegration é›†æˆ
- âœ… é…ç½®å’Œç¤ºä¾‹
- âœ… æµ‹è¯•å’Œæ–‡æ¡£

### æ€»ä½“è¿›åº¦

| æ–¹æ¡ˆ | èŒƒå›´ | çŠ¶æ€ | å®Œæˆåº¦ |
|------|------|------|--------|
| æ–¹æ¡ˆ A | æŠ€èƒ½ç³»ç»Ÿ | âœ… | 100% |
| æ–¹æ¡ˆ B | æŠ€èƒ½ + é’©å­ | âœ… | 100% |
| æ–¹æ¡ˆ C | å®Œæ•´é›†æˆ | â¬œ | å¯é€‰ |

---

## ğŸ“Š ç»Ÿè®¡æ•°æ®

### ä»£ç ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ–°å¢æ–‡ä»¶ | 5 ä¸ª |
| ä¿®æ”¹æ–‡ä»¶ | 1 ä¸ª |
| æ–°å¢ä»£ç è¡Œ | ~800 è¡Œ |
| æµ‹è¯•ä»£ç è¡Œ | ~300 è¡Œ |
| æ–‡æ¡£å­—æ•° | ~8,000 å­— |

### æ—¶é—´ç»Ÿè®¡

| é˜¶æ®µ | é¢„è®¡ | å®é™… |
|------|------|------|
| æ ¸å¿ƒå®ç° | 2-3h | 2h |
| ç³»ç»Ÿé›†æˆ | 1-2h | 1h |
| é…ç½®ç¤ºä¾‹ | 1h | 0.5h |
| æµ‹è¯•ç¼–å†™ | 1-2h | 1h |
| æ–‡æ¡£ç¼–å†™ | 1h | 1h |
| **æ€»è®¡** | **6-9h** | **5.5h** |

---

## ğŸ¯ ç”¨æˆ·ä»·å€¼

### å¯¹å¼€å‘è€…

1. **æ‰©å±•æ€§**
   - æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç å³å¯æ·»åŠ åŠŸèƒ½
   - æ’ä»¶åŒ–æ¶æ„

2. **çµæ´»æ€§**
   - æ”¯æŒå‘½ä»¤å’Œå‡½æ•°é’©å­
   - æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥æ‰§è¡Œ

3. **å¯ç»´æŠ¤æ€§**
   - é…ç½®æ–‡ä»¶ç®¡ç†
   - æ¸…æ™°çš„äº‹ä»¶æ¨¡å‹

### å¯¹é¡¹ç›®

1. **æ¾è€¦åˆ**
   - é’©å­ç³»ç»Ÿç‹¬ç«‹äºæ ¸å¿ƒé€»è¾‘
   - æ˜“äºæµ‹è¯•å’Œç»´æŠ¤

2. **å¯è§‚æµ‹æ€§**
   - ç»Ÿè®¡ä¿¡æ¯
   - æ—¥å¿—è®°å½•

3. **æ ‡å‡†åŒ–**
   - ç»Ÿä¸€çš„äº‹ä»¶é’©å­æœºåˆ¶
   - å…¼å®¹ Superpowers æ ¼å¼

---

## ğŸ“š å‚è€ƒèµ„æ–™

### é¡¹ç›®æ–‡æ¡£

- [HookSystem ä½¿ç”¨æŒ‡å—](../docs/HookSystem.md)
- [WorkflowIntegration æ–‡æ¡£](../docs/workflow-integration.md)
- [æµ‹è¯•å¥—ä»¶](../tests/core/HookSystem.test.js)

### å¤–éƒ¨èµ„æº

- [Superpowers é’©å­ç³»ç»Ÿ](https://github.com/obra/superpowers/tree/main/hooks)
- [äº‹ä»¶é©±åŠ¨æ¶æ„](https://martinfowler.com/articles/201701-event-driven.html)

---

## âœ¨ æ€»ç»“

**æ–¹æ¡ˆ Bï¼ˆæ ‡å‡†é›†æˆï¼‰å·²æˆåŠŸå®Œæˆï¼**

### å…³é”®æˆæœ

1. âœ… **å®Œæ•´çš„é’©å­ç³»ç»Ÿ**
   - æ ¸å¿ƒåŠŸèƒ½å®ç°
   - ç³»ç»Ÿé›†æˆå®Œæˆ
   - æµ‹è¯•è¦†ç›–å……åˆ†

2. âœ… **å¢å¼ºçš„æ‰©å±•æ€§**
   - äº‹ä»¶é©±åŠ¨æ¶æ„
   - æ’ä»¶åŒ–èƒ½åŠ›
   - é…ç½®åŒ–ç®¡ç†

3. âœ… **ä¼˜ç§€çš„æ–‡æ¡£**
   - è¯¦ç»†ä½¿ç”¨æŒ‡å—
   - ä¸°å¯Œçš„ç¤ºä¾‹
   - å®Œæ•´çš„ API æ–‡æ¡£

### ä¸‹ä¸€æ­¥

æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼Œå¯ä»¥é€‰æ‹©ï¼š

- **ä¿æŒç°çŠ¶**ï¼šå·²æ»¡è¶³æ ‡å‡†é›†æˆéœ€æ±‚
- **ç»§ç»­æ‰©å±•**ï¼šé›†æˆ CommandRouter å’Œ AgentSystem
- **æ–¹æ¡ˆ C**ï¼šå®Œæ•´æ’ä»¶åŒ–ï¼ˆå‘½ä»¤ç³»ç»Ÿ + åŠ¨æ€åŠ è½½ï¼‰

---

**æŠ¥å‘Šå®Œæˆæ—¶é—´**: 2026-02-17
**é›†æˆè´Ÿè´£äºº**: Claude (Anthropic)
**æœ€ç»ˆçŠ¶æ€**: âœ… æ–¹æ¡ˆ B å®Œæˆ
**å»ºè®®**: æ‰¹å‡†å‘å¸ƒï¼Œå¯é€‰ç»§ç»­æ‰©å±•
